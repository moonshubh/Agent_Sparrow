# Railway deployment configuration for MB-Sparrow with Supabase (no local PostgreSQL)
# This configuration deploys backend service only
# For multi-service deployments, use separate railway.toml files or Railway dashboard

"$schema" = "https://railway.com/railway.schema.json"

[build]
builder = "RAILPACK"

[env]
# Enforce production security
FORCE_PRODUCTION_SECURITY = "true"
ENABLE_AUTH_ENDPOINTS = "true"
ENABLE_API_KEY_ENDPOINTS = "true"
SKIP_AUTH = "false"
ENABLE_LOCAL_AUTH_BYPASS = "false"

# Restrict OAuth logins to Mailbird domain
ALLOWED_OAUTH_EMAIL_DOMAINS = "getmailbird.com"

# Zendesk limits (per plan)
ZENDESK_RPM_LIMIT = "240"
ZENDESK_MONTHLY_API_BUDGET = "1500"

# CORS: set to your frontend domain (comma-separated for multiple)
# Example: "https://agentsparrow-frontend.up.railway.app,https://mailbird.com"
# CORS_ALLOW_ORIGINS = ""

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 5
# Note: Health checks will wait 3 minutes for app initialization before starting
# SSE endpoints require proxy buffering to remain disabled so character-by-character
# streaming isn't coalesced by Railway's nginx proxy layer.
